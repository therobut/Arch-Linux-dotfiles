(function(){function t(){var e=$("#keyboard-shortcut-text").attr("placeholder"),t=$("#keyboard-shortcut-text").val();if(e===t)$(".shortcut-info").text("");else{var n=$("<a href='#''>Reset to default</a>");n.click(function(t){$("#keyboard-shortcut-text").removeClass("error"),sendMessage({action:"setSetting",key:"keyboard-shortcut-add",value:e}),r(),$(".shortcut-info").text(""),document.body.style.cursor="default",t.preventDefault()}),$(".shortcut-info").html(n)}}function n(){navigator.onLine&&sendMessage({action:"isValidToken"},function(e){e.value===!1&&sendMessage({action:"getSetting",key:"username"},function(e){e.value!==""&&sendMessage({action:"logout"},function(e){r()})})})}function r(){var n=document.getElementById("username-field"),r=document.getElementById("logout-link-wrapper"),i=document.getElementById("login-link-wrapper");sendMessage({action:"getSetting",key:"username"},function(s){var o=s.value;o?(n.innerHTML=o,r.style.display="inline",n.style.display="inline",i.style.display="none"):(n.style.display="none",r.style.display="none",i.style.display="inline"),$.each(e,function(e,t){var n="#"+t+"-checkbox";sendMessage({action:"getSetting",key:t},function(e){$(n).prop("checked",boolFromString(e.value))})}),sendMessage({action:"getSetting",key:"keyboard-shortcut-add"},function(e){var n=e.value;n!==undefined&&$("#keyboard-shortcut-text").val(n),t()})})}function i(e){return e.length>0&&e.match(/^(((alt|shift|ctrl|command|⌘|⌥|⌃|⇧)\+)+([a-z0-9]{1}\+)*([a-z0-9]{1}))$/gi)===null?!1:!0}function s(){var e="Pocket for";isOpera()?e+=" Opera":isChrome()?e+=" Chrome":isSafari()&&(e+=" Safari"),e+=" Options",document.title=e}function o(){$.each(e,function(e,t){var n="#"+t+"-checkbox";$(n).click(function(){sendMessage({action:"setSetting",key:t,value:stringFromBool($(this).is(":checked"))})})})}function u(){isMac()?$("#ril-topics-links-win").hide():$("#ril-topics-links-mac").hide();var e;isOpera()?e="?s=OPERA_EXT_OPTIONS":isChrome()?e="?s=CHROME_EXT_OPTIONS":isSafari()&&(e="?s=SAFARI_EXT_OPTIONS");var t=[{selector:".ril-web a",link:"http://getpocket.com/a"+e},{selector:".ril-iphone-ipad a",link:"http://getpocket.com/ios"+e},{selector:".ril-mac a",link:"http://getpocket.com/mac"+e},{selector:".ril-android a",link:"http://getpocket.com/android"+e},{selector:".ril-iphone a",link:"http://getpocket.com/iphone"+e},{selector:".ril-ipad a",link:"http://getpocket.com/android"+e}];$.each(t,function(e,t){$(t.selector).attr("href",t.link)})}function a(){(function(){$("#logout-link").click(function(){sendMessage({action:"logout"},function(e){r()})}),$("#login-link").click(function(){sendMessage({action:"showLoginWindow"})}),$("#search-support-link").click(function(e){var t="http://help.getpocket.com";sendMessage({action:"openTab",url:t}),e.preventDefault()}),$("#send-us-an-email-link").click(function(e){var t=isChrome()?"http://help.getpocket.com/customer/portal/emails/new?email%5Bsubject%5D=Question+about+Pocket+Extension+for+Chrome":"http://help.getpocket.com/customer/portal/emails/new?email%5Bsubject%5D=Question+about+Pocket+Extension+for+Safari";sendMessage({action:"openTab",url:t}),e.preventDefault()}),$("#get-in-touch-on-twitter-link").click(function(e){var t;isOpera()?t="%23opera ":isChrome()?t="%23chrome ":isSafari()&&(t="%23safari ");var n="https://twitter.com/intent/tweet?screen_name=pocketsupport&text="+t;sendMessage({action:"openTab",url:n}),e.preventDefault()})})(),function(){var t=isMac()?"⌘+⇧+P":"ctrl+shift+S";$("#keyboard-shortcut-text").attr("placeholder",t);var n={16:!1,18:!1,17:!1,91:!1},s="all",o=isMac()?"⇧":"shift",u=isMac()?"⌥":"alt",a=isMac()?"⌃":"ctrl",f=isMac()?"⌘":"command",l={16:o,18:u,17:a,91:f},c={8:"backspace",9:"tab",12:"clear",13:"enter",27:"esc",32:"space",37:"left",38:"up",39:"right",40:"down",46:"del",36:"home",35:"end",33:"pageup",34:"pagedown",188:",",190:".",191:"/",192:"`",189:"-",187:"=",186:";",222:"'",219:"[",221:"]",220:"\\"},h=[];$("#keyboard-shortcut-text").keydown(function(e){var t=e.keyCode;if(t===8)$(this).val("");else if(t===13||t===27)$(this).blur();else{var n=l[t]||c[t]||String.fromCharCode(t).toUpperCase();h.indexOf(n)==-1&&(h.push(n),$(this).val(h.join("+")))}e.preventDefault()}),$("#keyboard-shortcut-text").keyup(function(e){h=[]}),$("#keyboard-shortcut-text").focus(function(e){this.select(),this.onmouseup=function(){return this.onmouseup=null,!1},$(".shortcut-info").text("Record a new shortcut")}),$("#keyboard-shortcut-text").focusout(function(e){$(this).removeClass("error");var t=$(this).val().trim().replace(/[\s\,\&]/gi,"+").replace(/[^A-Z0-9⇧⌥⌃⌘\+]/gi,"");$(this).val(t);var n,s;t===""?(n="keyboard-shortcut-add",s=$("#keyboard-shortcut-text").attr("placeholder"),sendMessage({action:"setSetting",key:n,value:s})):i(t)?(n="keyboard-shortcut-add",s=t,sendMessage({action:"setSetting",key:n,value:s})):$(this).addClass("error"),r()})}(),s(),o(),u(),r(),n()}var e=["twitter","hackernews","reddit","yahoo","keyboard-shortcut"];window.onload=a,addMessageListener(function(e,t,n){e.action==="updateOptions"&&r()})})();