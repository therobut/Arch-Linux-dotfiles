(function(){if(isSafari()&&window.top!=window)return;var e={};e.base="http://news.ycombinator.org/",e.buttons=[{text:"save to pocket",successText:"saved to pocket",container:"td.subtext",className:"pocket-hn-button",selector:".pocket-hn-button",data:function(t){var n=$(t).parents("tr").prev("tr").find(".title").children("a"),i=$(n).text().trim(),s=$(n).attr("href").trim(),o=r(s,e.base);return{title:i,url:o}}}];var t=function(e){var t=document.createElement("a");return t.setAttribute("class",e.className),t.setAttribute("href","#"),$(t).text(e.text),t},n=function(){var n,r=e.buttons.length;for(n=0;n<r;n++){var i=e.buttons[n];$(i.container).each(function(){var e=$(this);if($(e).hasClass("pocket-inserted"))return;$(e).addClass("pocket-inserted");var n=t(i);$(e).append(n),$(n).before(" | ");var r=i.data;$(n).click(function(t){var s=r(n),o={identifier:"hackernews",action:"addURL",url:s.url,title:s.title,actionInfo:{cxt_ui:"btn_hackernews",cxt_url:window.location.href}};sendMessage(o,function(e){e.status==="success"&&($(n).replaceWith($("<span>"+i.successText+"</span>")),document.body.style.cursor="default")}),t.preventDefault()})})}},r=function(e,t){if(/^https?:/.test(e))return e;var n=document,r=n.getElementsByTagName("base")[0],i=r&&r.href,s=n.head||n.getElementsByTagName("head")[0],o=r||s.appendChild(n.createElement("base")),u=n.createElement("a"),a;return o.href=t,u.href=e,a=u.href,r?r.href=i:s.removeChild(o),a};addMessageListener(function(e,t,r){e.action==="settingChanged"&&e.key==="hackernews"&&(e.value==="true"||e.value===!0)&&n()}),sendMessage({action:"getSetting",key:"hackernews"},function(e){(e.value==="true"||e.value===!0)&&n()})})();