$(function(){function n(e){var n=t+$(e).parent("ul").find("a.js-open-close-tweet").attr("href"),r=$(e).parents("div.tweet"),i=r.attr("data-screen-name"),s=r.find("p.js-tweet-text").html().replace(/\n/g," "),o=r.find("p.js-tweet-text").find("a").not(".twitter-atreply").not(".twitter-hashtag"),u={identifier:"twitter",action:"addURL",url:o[0].href,title:i+": "+s,actionInfo:{ref_id:$(e).find("a").attr("data-tweet-id"),cxt_ui:"btn_twitter",cxt_url:window.location.href}};return sendMessage(u,function(e){}),!1}function r(e){$(e).click(function(e){e.preventDefault(),e.stopPropagation(),n(this)})}function i(e,t,n){var i=$('<li class="action-pocket-container"><a href="#" class="pocket-action" data-tweet-id="'+e+'" title="Pocket"><span><i></i><b>Pocket</b></span></a></li>');return r(i),i}function s(){var t=e.pocketButtons.length;for(var n=0;n<t;n++){var r=e.pocketButtons[n],s=$(r.container).not(".pocket-inserted"),o=s.length;if(o==0)continue;for(var u=0;u<o;u++){var a=s[u];if(a.className.indexOf("pocket-inserted")!==-1)continue;var f=$(a);f.addClass("pocket-inserted");var l=f.parents("div.tweet").find("p.js-tweet-text").find("a").not(".twitter-atreply").not(".twitter-hashtag");if(l.length>0){var c=f.parents(".tweet").attr("data-item-id"),h=i(c,r.name,r.className);$(r.after).each(function(e,t){var n=f.find(t);if(n.length>0)return n.after(h),!1}),h.find("i").css("background-color",h.find("b").css("color"))}}}}function u(){typeof o=="undefined"&&(s(),o=setInterval(s,e.refreshInterval))}function a(){typeof o!="undefined"&&(clearInterval(o),o=undefined)}function l(){c(),f=setTimeout(function(){u()},500)}function c(){typeof f!="undefined"&&(clearTimeout(f),f=undefined)}function p(){d(),h=function(){a(),l()},$(window).on("scroll",h)}function d(){typeof h!="undefined"&&$(window).off("scroll",h)}function v(){u(),p()}if(isSafari()&&window.top!=window)return;var e={refreshInterval:1500,pocketButtons:[{name:"pocket-action",text:"Pocket",container:".stream div.stream-item-footer .tweet-actions, .permalink .simple-tweet div.stream-item-footer .tweet-actions:not(:has(a.pocket-action))",after:[".buffer-action",".action-fav-container"],className:"pocket-action",selector:".pocket-action"},{name:"pocket-permalink",text:"Pocket",container:".permalink-tweet div.stream-item-footer .tweet-actions",after:[".buffer-action",".action-fav-container"],className:"pocket-action",selector:".pocket-action"}]},t="http://twitter.com",o,f,h;addMessageListener(function(e,t,n){if(e.action==="settingChanged"&&e.key==="twitter")if(e.value==="true"||e.value===!0)v();else if(e.value==="false"||e.value===!1)d(),c(),a()}),sendMessage({action:"getSetting",key:"twitter"},function(e){(e.value==="true"||e.value===!0)&&v()})});