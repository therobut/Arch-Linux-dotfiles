(function(){function i(){typeof r=="undefined"&&(n(),r=setInterval(n,e.refreshInterval))}function s(){typeof r!="undefined"&&(clearInterval(r),r=undefined)}function u(){a(),o=setTimeout(function(){i()},500)}function a(){typeof o!="undefined"&&(clearTimeout(o),o=undefined)}function l(){c(),f=function(){s(),u()},$(window).on("scroll",f)}function c(){typeof f!="undefined"&&$(window).off("scroll",f)}function h(e){i(),l()}if(isSafari()&&window.top!=window)return;var e={};e.refreshInterval=1500,e.buttons=[{text:"pocket",successText:"saved to pocket",container:".content.cf",className:"side-button pocket-yahoo-button",selector:".pocket-yahoo-button",data:function(e){var t=$(e).attr("data-url").trim();t=unescape(t);var n=$(e).find("a")[0],r=$(n).text().trim();return{title:r,url:t}}}];var t=function(e){var t=document.createElement("a");return t.setAttribute("class",e.className),t.setAttribute("href","#"),t.style.cssText="top:31px;display:none;",t},n=function(){var n,r=e.buttons.length;for(n=0;n<r;n++){var i=e.buttons[n],s=$(i.container).not(".pocket-inserted"),o=s.length;if(o===0)continue;$.each(s,function(e,n){if(n.className.indexOf("pocket-inserted")!==-1)return!1;var r=$(n);r.addClass("pocket-inserted");var s=t(i),o=$(s);$(r.find(".side-button")[1]).css("top","56px"),o.insertAfter(r.find(".side-button")[0]),r.hover(function(){o.show()},function(){o.hide()}),r.is(":hover")&&o.show();var u=i.data;o.click(function(t){var n=u(r),i={identifier:"yahoo",action:"addURL",url:n.url,title:n.title,actionInfo:{cxt_ui:"btn_yahoo",cxt_url:window.location.href}};return sendMessage(i,function(e){}),t.preventDefault(),!1})})}},r,o,f;addMessageListener(function(e,t,n){if(e.action==="settingChanged"&&e.key==="yahoo")if(e.value==="true"||e.value===!0)h();else if(e.value==="false"||e.value===!1)c(),a(),s()}),sendMessage({action:"getSetting",key:"yahoo"},function(e){(e.value==="true"||e.value===!0)&&h()})})();